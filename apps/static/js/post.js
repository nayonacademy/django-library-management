$(document).ready(function(){var a=140;$("#post").on("click",function(){$("#post_form .post_header").text("Compose new Post");$("#post_form #post_text, #post_form #post_button").show();$("#hash_items_store").text("");$("#overlay").css({display:"block"});$("#post_form").show();$("#post_form textarea").focus();$("#count_chars").show().text(a)});$("#overlay, #post_form .post_close").on("click",function(){$("#post_form #post_text").css("background-color","#FFF");$("#post_form #post_text").val("");$("#overlay").hide();$("#flag_form").hide();$("#post_form").hide();$("#post_suggest").hide();$("#hash_items_store").text("");$("#post_form #repost_id").text("");$("#post_form #reply_id").text("");$("#count_chars").show().text(a);$("#post_form #repost_text").text("");$("#post_form textarea").show()});$("#post_form #post_button").on("click",function(){var n=$("#post_form #post_text").val();var i=$("#hash_items_store").text();var m=parseInt($("#post_form #repost_id").text());var k=parseInt($("#post_form #reply_id").text());var j=$.trim(n);if((j==""||j==undefined)&&isNaN(m)){$("#post_form #post_text").css("background-color","#FF9494")}else{$("#overlay").hide();$("#flag_form").hide();$("#post_form").hide();$("#count_chars").text(a);$("#hash_items_store").text("");$("#post_form #repost_id").text("");$("#post_form #reply_id").text("");if(!isNaN(m)&&m>0){n=$("#repost_text").text()}else{m=0}$("#repost_text").text("");$("#reply_id").empty();$("#repost_id").empty();var l=$.trim(n);$("#post_form #post_text").val("");$.ajax({type:"POST",url:"/library/functions/post.php",data:"post="+encodeURIComponent(l)+"&hash_items_store="+encodeURIComponent(i)+"&repost_id="+encodeURIComponent(m)+"&reply_id="+encodeURIComponent(k),success:function(o){$("#all_posts").click()}})}});$("#social_feed, .full_box").on("click",".repost",function(){var l=$(this);var k=l.parent();var i=k.prevAll(".post_text_single").text();var j=k.nextAll(".post_id").val();$("#post_form .post_header").text("Repost to your followers?");$("#post_form #post_text, #post_form #post_button").show();$("#hash_items_store").text("");$("#overlay").css({display:"block"});$("#post_form").show();$("#post_form #repost_id").text(j);$("#post_form #repost_text").text(i);$("#post_form #count_chars").hide();$("#post_form textarea").hide()});$("#social_feed, .full_box").on("click",".reply",function(){var i=$(this);var o=i.parent();var k=o.prevAll(".post_text_single").text();var m=o.nextAll(".post_id").val();var l=o.nextAll(".reply_id").val();var j=o.prevAll(".post_user").text();var n=$("#post_form #post_text");$("#post_form .post_header").text("Reply to "+j);$("#post_form #post_text, #post_form #post_button").show();$("#hash_items_store").text("");$("#overlay").css({display:"block"});$("#post_form").show();n.focus().val(j+" ").keyup();if(l==undefined||l<=0||isNaN(l)){$("#post_form #reply_id").text(m)}else{$("#post_form #reply_id").text(l)}$("#post_form #repost_text").text(k)});$("#social_feed, .full_box").on("click",".discussion",function(){var j=$(this);var l=j.prevAll(".post_text_single").text();var m=j.nextAll(".reply_id").val();var k=j.prevAll(".post_user").text();var i=$("#post_form #post_text");$("#post_form .post_header").text("Reply to "+k);$("#post_form #post_text, #post_form #post_button").show();$("#hash_items_store").text("");$("#overlay").css({display:"block"});$("#post_form").show();i.focus().val(k+" ").keyup();$("#post_form #reply_id").text(m);$("#post_form #repost_text").html('<div style="text-align:center"><img src="/images/ajax-loader.gif" alt=""></div>');$.ajax({type:"POST",url:"/library/functions/social-discussion.php",data:"post_id="+m,success:function(n){$("#post_form #repost_text").html(n)}})});$("#social_feed, .full_box").on("click",".trash",function(){$this=$(this);var i=$this.closest(".feed_entry").find(".post_id").val();modal("Delete this post?","Delete","modal_delete",function(){$this.parents(".feed_post").css("display","block").slideUp("fast");$.ajax({type:"POST",url:"/library/functions/post-delete.php",data:"post_id="+encodeURIComponent(i),success:function(j){}})},function(){})});$("#social_feed, .full_box").on("click",".post_user, user",function(){var i=$(this);var j=i.text().substring(1);window.location.href="/library/social-get-user-feed/"+j});$("#library_load").on("click",".all_posts_feed",function(){var i=$(this);var j=$("#library_load .at_username").text().substring(1);$.ajax({type:"POST",url:"/library/functions/social-get-user-feed.php",data:"username="+encodeURIComponent(j),success:function(k){$("#library_load").html(k)}})});$("#post_form #post_suggest").on("click",".atselect",function(n){var m=$(this);var j=m.parent().prev();var i=$.trim(j.val());i=i.substring(0,i.lastIndexOf(" "));var k=m.find(".lookups").text();var l=m.find(".lookup_item_id").text();if(l.length){$("#hash_items_store").append(l+",")}if(k.length>17){k=k.substring(0,17)+"..."}if(i.length){i=i+" "+k+" "}else{i=k+" "}m.parent().prev().val(i);j.focus();m.parent().hide();j.keyup()});$("#post_form #post_text").on("keydown",function(k){if(k.keyCode===13){$this=$(this);$this_selected=$this.next().find(".atselect.selected");var m=$this_selected.parent().prev();var l=$.trim(m.val());l=l.substring(0,l.lastIndexOf(" "));var i=$this_selected.find(".lookups").text();var j=$this_selected.find(".lookup_item_id").text();if(j.length){$("#hash_items_store").append(j+",")}if(i.length>17){i=i.substring(0,17)+"..."}if(l.length){l=l+" "+i+" "}else{l=i+" "}$this_selected.parent().prev().val(l);m.focus();$this_selected.parent().hide();$this_selected.removeClass("selected");k.preventDefault()}});$("#post_suggest").on("mouseenter",".atselect",function(){$("#post_suggest .atselect").removeClass("selected");$(this).addClass("selected")}).on("mouseleave",".hover",function(){$(this).removeClass("selected")});$("#post_form #post_text").on("keydown",function(l){var k=$(this);if(l.keyCode===38&&$(k.next()).is(":visible")&&k.next().find(".atselect.selected").length){l.preventDefault()}var i=k.val();var j=i.length;j=a-j;if(j<=0){$("#post_button").attr("disabled","disabled").css("opacity","0.4")}else{}});$("#post_form #post_text").on("keyup",function(j){var i=$(this);var l=i.val();var m=l.length;m=a-m;if(m<0){}else{$("#post_button").removeAttr("disabled").css("opacity","1")}if(m<0){m='<span style="color:#E44D26;font-weight:bold;">'+m+"</span>"}else{if(m<=15){m='<span style="color:#E44D26;">'+m+"</span>"}else{}}$("#count_chars").html(m);if(j.keyCode===40&&$(i.next()).is(":visible")&&!i.next().find(".atselect.selected").length){i.next().find(".atselect:first").addClass("selected")}else{if(j.keyCode===40&&$(i.next()).is(":visible")){i.next().find(".atselect.selected").next().addClass("selected");i.next().find(".atselect.selected").prev().removeClass("selected")}else{if(j.keyCode===38&&$(i.next()).is(":visible")&&i.next().find(".atselect.selected").length){i.next().find(".atselect.selected").prev().addClass("selected");i.next().find(".atselect.selected").next().removeClass("selected")}else{var o=i.val();var k=o.substring(o.lastIndexOf(" ")+1);var n=0;i.next().hide();if(k!=null&&k.indexOf("@")>-1){k=k.match(/@([a-zA-Z0-9]+)/g);if(k!=null){n=k.length}if(n>0){k=k[n-1];$.ajax({type:"POST",url:"/library/functions/post-at-lookup.php",data:"following="+k,success:function(p){i.next().show().html(p)}})}}if(k!=null&&k.indexOf("#")>-1){k=k.match(/#([a-zA-Z0-9]+)/g);if(k!=null){n=k.length}if(n>0){k=k[n-1];$.ajax({type:"POST",url:"/library/functions/post-hash-lookup.php",data:"title="+k,success:function(p){i.next().show().html(p)}})}}}}}});var g=setInterval(function(){f()},30000);$("#mention_posts").on("click",function(){var i=$(this);i.addClass("selected");$("#all_posts").removeClass("selected");$("#mention_count").text("");$.ajax({type:"POST",url:"/library/functions/social-feed-mentions.php",data:"",success:function(j){$("#social_feed_scroll").html(j)}})});$("#all_posts").on("click",function(){var i=$(this);i.addClass("selected");$("#mention_posts").removeClass("selected");$("#all_count").text("");clearInterval(g);g=setInterval(function(){f()},30000);$.ajax({type:"POST",url:"/library/functions/social-feed-all.php",data:"",success:function(j){$("#social_feed_scroll").html(j)}})});$("#social_feed").on("click","#more_posts",function(){var i=parseInt($(this).attr("class"));$(this).remove();$.ajax({type:"POST",url:"/library/functions/social-feed-all.php",data:"limit="+encodeURIComponent(i),success:function(j){$("#social_feed_scroll").append(j)}})});$("#social_feed").on("click","#more_mentions",function(){var i=parseInt($(this).attr("class"));$(this).remove();$.ajax({type:"POST",url:"/library/functions/social-feed-mentions.php",data:"limit="+encodeURIComponent(i),success:function(j){$("#social_feed_scroll").append(j)}})});var h=$("#all_count");function f(){$.ajax({type:"POST",url:"/library/functions/social-feed-all-update.php",data:"",success:function(k){var j=parseInt(k);if(j>0){var l=parseInt(h.text());if(isNaN(l)){l=0}l+k;var i=l+j;h.text(i)}},global:false})}var b=$("#mention_count");function d(){$.ajax({type:"POST",url:"/library/functions/social-feed-mentions-update.php",data:"",success:function(k){var j=parseInt(k);if(j>0){var l=parseInt(b.text());if(isNaN(l)){l=0}l+k;var i=l+j;b.text(i)}},global:false})}$("#find_friends").on("keyup","#find_friends_search",function(j){var i=$(this);var k=$.trim(i.val());if(j.keyCode==13&&k!=""){$.ajax({type:"POST",url:"/library/functions/social-find-friends.php",data:"search="+encodeURIComponent(k),success:function(l){$("#find_friends").hide().html(l).fadeIn();$("#find_friends").find("#find_friends_search").focus()}})}});$(".inner-wrapper").scroll(function(m){var i=parseInt($("#get_find_friends_more").attr("class"));if($(this).scrollTop()+$(this).innerHeight()+75>=this.scrollHeight&&!isNaN(i)){var l=$.trim($("#find_friends_wrapper h2").text());$("#get_find_friends_more").remove();$.ajax({type:"POST",url:"/library/functions/social-find-friends.php",data:"search="+encodeURIComponent(l)+"&limit="+encodeURIComponent(i)}).done(function(p){$("#find_friends").append(p)})}var n=parseInt($("#following_more").attr("class"));if($(this).scrollTop()+$(this).innerHeight()+75>=this.scrollHeight&&!isNaN(n)){$("#following_more").remove();$.ajax({type:"POST",url:"/library/functions/social-following.php",data:"limit="+encodeURIComponent(n)}).done(function(p){$("#social_following").append(p)})}var o=parseInt($("#followers_more").attr("class"));if($(this).scrollTop()+$(this).innerHeight()+75>=this.scrollHeight&&!isNaN(o)){$("#followers_more").remove();$.ajax({type:"POST",url:"/library/functions/social-followers.php",data:"limit="+encodeURIComponent(o)}).done(function(p){$("#social_followers").append(p)})}var k=parseInt($("#get_user_feed_more").attr("class"));if($(this).scrollTop()+$(this).innerHeight()+75>=this.scrollHeight&&!isNaN(k)){$("#get_user_feed_more").remove();var j=$(".user_header .at_username").text();$.ajax({type:"POST",url:"/library/functions/social-get-user-feed.php",data:"limit="+encodeURIComponent(k)+"&username="+encodeURIComponent(j)}).done(function(p){$("#social_get_user_feed").append(p)})}});$(".full_box").on("click",".follow",function(){var j=$(this);var i=j.val();if(i!=0){$.post("/library/functions/social-follow.php",{following:i}).done(function(k){if(k!="failed"){j.html("&#x2714; Following");j.attr("class","unfollow");$("#follows").load("/library/functions/social-followers-following.php")}})}else{notification("User could not be found!","notification_warning")}});$(".full_box").on("click",".unfollow",function(){var j=$(this);var i=j.val();$.post("/library/functions/social-unfollow.php",{following:i}).done(function(k){if(k!="failed"){j.html("Follow");j.attr("class","follow");$("#follows").load("/library/functions/social-followers-following.php")}})});var e=false;$(".open-menu").bind("touchstart click",function(){if(!e){e=true;setTimeout(function(){e=false},100);$("#second-sidebar").removeClass("show-sidebar");$("#search_options").hide();$("#first-sidebar").toggleClass("show-sidebar")}return false});var c=false;$(".open-feed").bind("touchstart click",function(){if(!c){c=true;setTimeout(function(){c=false},100);$("#first-sidebar").removeClass("show-sidebar");$("#second-sidebar").toggleClass("show-sidebar");$("#search_options").hide()}return false});$("div#close-feed").on("click",function(j){$("body").toggleClass("nofeed");$(this).toggleClass("switch");$("#social_feed_scroll").scrollTop(0);if($(".letter_range_fixed").length>0){var i=$(".inner-wrapper").width()-9;$(".letter_range_fixed").css({width:i,left:220})}$.post("/library/functions/feed-session.php")})});