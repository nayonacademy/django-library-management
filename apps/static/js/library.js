$(window).load(function(){var F=$(".mobile").css("display")=="none";$("#lib_select").chosen({width:"100%"});if(F){$("#lib_container").on("mouseenter",function(){$("#library_opts").show()}).on("mouseleave",function(){$("#library_opts").hide()})}$("#lib_home").on("click",".flag_warning",function(){$this=$(this);$("#flag_form #flag_text, #flag_form #flag_button").show();$("#flag_form .flag_submit_message").hide();$("#flag_form #flag_text").val("");var a=$this.closest(".book_finds").attr("id");$("#flag_id").val(a);var c=$this.closest(".book_finds").find(".book_title").text();$("#flag_form .flag_title").text(c);$("#overlay").css({display:"block"});$("#flag_form").show();$("#flag_form textarea").focus()});$("#overlay, #flag_form .flag_close").on("click",function(){$("#overlay").hide();$("#flag_form").hide();$("#post_form").hide()});$("#flag_form #flag_button").on("click",function(){var c=$.trim($("#flag_form #flag_text").val());$("#flag_form #flag_text").css("background-color","#FFF");if(c==""||c==undefined){$("#flag_form #flag_text").css("background-color","#FF9494")}else{$("#flag_form #flag_button").after('<div class="flag_submit_message">Error submitted!</div>');$("#flag_form #flag_text, #flag_form #flag_button").hide();var a=$("#flag_id").val();$.ajax({type:"POST",url:"/library/functions/flag-notification.php",data:"error="+encodeURIComponent(c)+"&join_id="+a,success:function(d){}})}});$("#search_options_reveal").on("click",function(){$("#search_options").toggle()});$("#lib_home").on("click","#asc_desc",function(){var a=$(this).attr("class");if(a=="DESC"){a="ASC"}else{a="DESC"}$(this).attr("class",a);$.ajax({type:"POST",url:"/library/functions/switch-asc-desc.php",data:"asc_desc="+encodeURIComponent(a)}).done(function(){$("#letter_range #all").click()})});$("#lib_home").on("change"," select.sort_select",function(){$this=$(this);var c=$(".hide_type").text();var a=$this.find("option:selected").val();$.ajax({type:"POST",url:"/library/functions/switch-sort-by.php",data:"sort_by="+encodeURIComponent(a)}).done(function(){$("#letter_range").load("/library/functions/directory.php",{sort_by:a},function(){$("#letter_range #all").click()})})});$(document).on({mouseenter:function(c){if(jQuery.support.noCloneChecked){var a=$(this).closest(".book_finds").attr("id");img=$(this);$(this).stop().animate({opacity:0.15},300,function(){$(this).prev(".replace_img_text").show()});if($(c.target).data("one")!="yes"){var d=$(this).dropzone({url:"/library/functions/image-upload.php?join_id="+a,response:function(f){if($.trim(f)=="error"){alert("There was an error processing your image.")}else{$(img).attr("src",$.trim(f))}}})}$(c.target).data("one","yes")}else{$(this).css("cursor","default")}},mouseleave:function(a){if(jQuery.support.noCloneChecked){$(this).stop().animate({opacity:1},300,function(){$(this).prev(".replace_img_text").hide()})}}},".book_image img");$(document).ajaxStart(function(){$(".log").children("img").show()});$(document).ajaxStop(function(){$(".log img").hide()});function C(a){$("#letter_range .letter").each(function(){$(this).removeClass("active")});if(a=="number"){$("#letter_range #number").addClass("active")}else{if(a!="all"&&a!=""&&a!="undefined"){$("#letter_range #letter_"+a).addClass("active")}else{a="all";$("#letter_range #all").addClass("active")}}$.ajax({type:"POST",url:"functions/load-library.php",data:"letter="+encodeURIComponent(a),success:function(c){$("#library_load").hide().html(c).fadeIn()}})}$("#list_type_sprite").on("click",'.with_image:not(".selected"), .without_image:not(".selected"), .cover_only:not(".selected")',function(){var c=$(this).attr("class");var a=$("#letter_range .active").attr("id");$(".with_image, .without_image, .cover_only").removeClass("selected");$(this).addClass("selected");if(a=="number"){a="number"}else{if(a!="all"&&a!=""&&a!=undefined&&a!="undefined"){a=a.charAt(a.length-1)}else{a="all"}}$.ajax({type:"POST",url:"functions/list-style.php",data:"list_setting="+c,success:function(d){C(a)}})});$(document).on("change","#lib_select",function(){$("#library_stats").hide();var a=parseInt($(this).val());$.ajax({type:"POST",url:"functions/library-session.php",data:"library_id="+a,success:function(c){w();$("#library_inner").hide();C("all");$("#letter_range").load("/library/functions/directory.php",{library_id:a});$("#second-sidebar-overlay").removeClass("slide-in");if(F){b()}}})});function w(){var a=$("#lib_select").val();$(".lib_count_items").remove();$.ajax({type:"POST",url:"functions/library-info.php",data:"library_id="+a,success:function(c){$("#lib_info").html(c);$(".lib_count_items").prependTo("#library_list")}})}w();function b(){$.ajax({type:"POST",url:"functions/stats-summary.php",data:"post=test",success:function(a){$("#library_stats").html(a).fadeIn("slow")}})}$("#library_page").on("click","#library_stats .status_name",function(){var a=$(this).text();$("#search_local").val("status: "+a);var c=jQuery.Event("keyup");c.keyCode=13;$("#search_local").trigger(c)});$("#library_list").on("click",".lib_inner_edit_title",function(){var d=$("#lib_container .chosen-single span").text();var a=parseInt($("#lib_container").height())-18;var c=$("#library_list #lib_select option:selected").val();$("#lib_container").before('<textarea id="'+c+'" class="title" style="height:'+a+'px" maxlength="100" >'+d+"</textarea>");$("#lib_container").hide();$("textarea#"+c).focus().select()});$(document).on("keyup","#lib_active textarea, #library_list textarea",function(a){if(a.keyCode===13){$(this).blur()}});$(document).on("blur","#library_list textarea.title",function(){var f=$(this);if($.trim($(this).val())!=""){f.removeClass("error");var c=$(this).attr("id");var g=$(this).attr("class");var a=$("#lib_select").val();var d=$.trim($(this).val());$.ajax({type:"POST",url:"functions/library-edit.php",data:"text="+encodeURIComponent(d)+"&title_desc="+g+"&library_id="+a,success:function(h){h=$.trim(h);f.remove();$("#lib_select option:selected").html(h);$("#lib_select").trigger("chosen:updated");$("#lib_container .chosen-single span").html(h);$("#lib_container").show()}})}else{f.addClass("error")}});$("#letter_range").on("click",".letter, .rating, .year_added, .ddc",function(){$("#letter_range .letter, #letter_range .rating, #letter_range .year_added, #letter_range .ddc").each(function(){$(this).removeClass("active")});var a=$(this).attr("id");a=a.replace("_",".");$(this).addClass("active");if(a=="number"){a="number"}else{if(a=="all"){a="all"}else{if(parseFloat(a)>0&&a.length<=3){a=parseFloat(a)}else{if(parseInt(a)>0&&a.length==4){a=parseInt(a)}else{if(a!=""&&a!="undefined"){var a=a.charAt(a.length-1)}else{a="all"}}}}}$.ajax({type:"POST",url:"functions/load-library.php",data:"letter="+encodeURIComponent(a),success:function(c){$("#library_inner").hide();$("#library_load").hide().html(c).fadeIn()}})});$("#lib_home").on("click","delete_join, .delete_book .sprite",function(){var c=$(this).parent();var a=c.attr("id");var d=$(this).closest(".detail");modal("Delete this item from your library?","Delete","modal_delete",function(){$.ajax({type:"POST",url:"functions/book-delete.php",data:"join_id="+encodeURIComponent(a),success:function(f){}});d.animate({opacity:0.25,left:"-=800",height:5},250,function(){d.remove()})},function(){})});$("#library_load").on("click",".barcodes .add-copy",function(){var j=$(this).closest(".book_info").find(".copies");var f=$(this).next(".copies-to-add");var g=$(this).closest(".barcodes");var h=0;var d=parseInt(j.find(".plus_num").text());var c=parseInt(f.val());h=c+d;var a=$(this).closest(".book_finds").attr("id");if(c<=0||isNaN(c)){notification("Must add a positive number of copies!","notification_warning")}else{if(h>0&&h<=255&&c>0){j.find(".copies_text").removeClass("one_copy");j.find(".plus_num").text(h);j.find(".copies_text").text("copies");$(this).attr("disabled","disabled");f.attr("disabled","disabled");$.ajax({type:"POST",url:"functions/copies-add.php",data:"join_id="+encodeURIComponent(a)+"&copies="+encodeURIComponent(h)}).done(function(k){g.load("functions/barcode-list.php",{join_id:encodeURI(a)})})}else{notification("Max copies per item is 255!","notification_warning")}}});$("#library_load").on("click",".barcodes .minus-copy",function(){var h=$(this).closest(".book_info").find(".copies");var d=$(this).parent();var c=h.find(".plus_num").text();var g=$(this).attr("id");var a=$(this).closest(".book_finds").attr("id");var f=false;if(g.length>0){$.ajax({type:"POST",url:"functions/barcode-delete.php",async:false,data:{join_id:encodeURIComponent(a),barcode_id:encodeURIComponent(g)}}).done(function(j){if($.trim(j)=="lent"){f=true;notification("Copy info can not be changed while item is lent out!","notification_warning")}})}c=parseInt(c)-1;if(c==0&&!f){d.find("input").val("");notification("Copy info successfully removed!","notification_success")}else{if(c>0&&!f){h.find(".plus_num").text(c);d.addClass("hide");if(c>1){h.find(".copies_text").text("copies")}else{h.find(".copies_text").addClass("one_copy");h.find(".copies_text").text("copy")}$.ajax({type:"POST",url:"functions/copies-add.php",data:"join_id="+encodeURIComponent(a)+"&copies="+encodeURIComponent(c),success:function(j){notification("Copy successfully removed!","notification_success")}})}}});$("#library_load").on("keyup",".item-barcode, .item-condition",function(){$(this).siblings(".save-barcode").removeClass("existing-barcode")});$("#library_load").on("click",".barcodes .save-barcode",function(){var d=$(this);var f=true;var a=d.closest(".book_finds").attr("id");var g=d.attr("id");var c=$.trim(d.siblings(".item-condition").val());var h=$.trim(d.siblings(".item-barcode").val());if(h.length>0&&isNaN(h)){notification("Barcodes can only be numbers!","notification_warning");d.siblings(".item-barcode").addClass("missing");f=false}else{if(h.length>0&&h.length<5){notification("Barcode minimum length is 5 digits!","notification_warning");d.siblings(".item-barcode").addClass("missing");f=false}else{d.siblings(".item-barcode").removeClass("missing")}}if(f&&(h.length>=5||c.length>0)){$.post("/library/functions/barcode-add.php",{join_id:encodeURIComponent(a),barcode_id:encodeURIComponent(g),barcode:encodeURIComponent(h),condition:encodeURIComponent(c)}).done(function(j){if($.trim(j)=="fail"){notification("Copy info failed to save, possible duplicate!","notification_warning")}else{if($.trim(j)=="lent"){notification("Copy info can not be changed while item is lent out!","notification_warning")}else{if($.trim(j).length>0){notification("Copy info successfully saved!","notification_success");d.attr("id",$.trim(j));d.addClass("existing-barcode");d.next(".minus-copy").attr("id",$.trim(j))}else{notification("Copy info successfully saved!","notification_success");d.addClass("existing-barcode")}}}})}else{if(f){$.post("/library/functions/barcode-delete.php",{join_id:encodeURIComponent(a),barcode_id:encodeURIComponent(g)}).done(function(j){if($.trim(j)=="fail"){notification("Copy info failed to save, refresh and try again!","notification_warning")}else{if($.trim(j)=="lent"){notification("Copy info can not be changed while item is lent out!","notification_warning")}else{notification("Copy info successfully saved!","notification_success");d.attr("id","");d.addClass("existing-barcode");d.next(".minus-copy").attr("id","")}}})}}});$("#library_load").on("click",".copies.contracted",function(){var a=$(this).closest(".detail").children(".book_finds").attr("id");$(this).closest(".detail").find(".barcodes").show().load("functions/barcode-list.php",{join_id:a});$(this).closest(".detail").find(".copies").removeClass("contracted");$(this).closest(".detail").find(".copies").addClass("expanded")});$("#library_load").on("click",".copies.expanded",function(){$(this).closest(".detail").find(".barcodes").slideUp("fast");$(this).closest(".detail").find(".copies").removeClass("expanded");$(this).closest(".detail").find(".copies").addClass("contracted")});$(document).on("click","span.show_more",function(){$(this).parent().hide();$(this).parent().next(".book_description_full").show()});$(document).on("click","span.show_less",function(){$(this).parent().hide();$(this).parent().prev(".book_description").show()});$(document).on("click",".group_name.group_expand_allowed:not(.group_expanded)",function(){$(this).addClass("group_expanded");$(this).nextUntil(":not(.grouped)").each(function(){var c=$(this);var d=c.attr("class");var a=c.attr("id");if(a!=undefined&&a.length>0){$.ajax({type:"POST",url:"functions/load-book.php",data:"join_id="+encodeURIComponent(a)+"&classes="+encodeURIComponent(d),success:function(f){c.replaceWith(f)}})}})});$(document).on("click",".group_expand_allowed.group_expanded",function(a){$(this).removeClass("group_expanded");$(this).nextUntil(":not(.grouped)").each(function(){var f=$(this);var c=f.find(".book_title").text();if(c!=undefined&&c.length>0){var k=f.find(".book_finds").attr("id");var j=f.closest(".detail").attr("class");var d=f.find(".book_authors").text();d=d.replace("Director:","");var g="";var h=f.find("#identification_numbers").html();if(j.toLowerCase().indexOf("grouped")>=0){g=" grouped"}f.animate({opacity:0.25,width:200,height:30},"fast",function(){$(this).closest(".revert_title").replaceWith('<div id="'+k+'" class="list'+g+'">'+c+'<div class="list_secondary_detail">'+d+'</div><div class="book_data">'+h+"</div></div>").hide()})}})});$(document).on("click",".list",function(){var c=$(this);var d=$(this).attr("class");var a=$(this).attr("id");var f="list_list";$.ajax({type:"POST",url:"functions/load-book.php",data:"join_id="+encodeURIComponent(a)+"&classes="+encodeURIComponent(d)+"&list_type="+encodeURIComponent(f),success:function(g){c.replaceWith(g)}})});$(document).on("click",".revert_title.list_list .book_title",function(d){var k=$(this).text();k=$("<div/>").text(k).html();var j=$(this).closest(".book_finds").attr("id");var c=$(this).closest(".detail").attr("class");var a=$(this).next(".book_authors").text();a=a.replace("Director(s):","");var g="";var f=$(this).parent().find("#identification_numbers").html();var h=$(this).parent().find("#identification_numbers2").html();if(c.toLowerCase().indexOf("grouped")>=0){g=" grouped"}$(this).closest(".revert_title").animate({opacity:0.25,width:200,height:30},150,function(){$(this).closest(".revert_title").replaceWith('<div id="'+j+'" class="list'+g+'">'+k+'<div class="list_secondary_detail">'+a+'</div><div class="book_data">'+f+'</div><div class="book_data">'+h+"</div></div>").hide()})});$(document).on("click",".cover",function(){var c=$(this);var d=c.attr("class");var a=c.attr("id");var f="cover_list";$.ajax({type:"POST",url:"functions/load-book.php",data:"join_id="+encodeURIComponent(a)+"&classes="+encodeURIComponent(d)+"&list_type="+encodeURIComponent(f),success:function(g){c.replaceWith(g)}})});$(document).on("click",".revert_title.cover_list .book_title",function(d){var a=$(this).closest(".book_finds").find(".book_image img").attr("src");var c=$(this).closest(".book_finds").attr("id");var g=$(this).closest(".detail").attr("class");var f="";if(g.toLowerCase().indexOf("grouped")>=0){f=" grouped"}$(this).closest(".revert_title").animate({opacity:0.25,width:200,height:30},150,function(){$(this).closest(".revert_title").replaceWith('<div id="'+c+'" class="cover'+f+'"><img alt="" src="'+a+'"></div>').hide()})});$("#lib_home").on("click","#tags_quick_list",function(){$("#second-sidebar-overlay").load("functions/tags-quick-list.php");$("#second-sidebar-overlay").toggleClass("slide-in")});$("#second-sidebar-overlay").on("click",".close",function(){$("#second-sidebar-overlay").removeClass("slide-in")});$("#to_top").on("click",function(){$("html, body").animate({scrollTop:0},"fast")});$("#search_local").on("keyup",function(c){if(c.keyCode==13){$("#library_list").addClass("hide");$("#letter-range-holder").addClass("hide");$("#library_inner").html('<img alt="" src="/images/ajax-loader.gif" style="margin-left: calc(50% - 20px); padding:20px;">');$("#first-sidebar #menu-home").removeClass("active-item");var a=$(this).val();$("#search_options").hide();$.ajax({type:"POST",url:"functions/search.php",data:"search="+encodeURIComponent(a),success:function(d){$("#library_load").hide().html(d).fadeIn()}})}});if($("#search_local").val().length>0){var u=jQuery.Event("keyup");u.keyCode=13;$("#search_local").trigger(u)}$("#clear_search").on("click",function(){$('#search_options input:not("#submit_search")').each(function(){$(this).val("")})});$("#all_libraries").on("click",function(){$(this).toggleClass("on");$("#search_local").toggleClass("search_all");$("#second-sidebar-overlay").removeClass("slide-in");var a="false";if($(this).hasClass("on")){a="true"}$.post("functions/all-libraries.php",{all_libraries_setting:a})});$("#search_options").on("keyup",function(a){if(a.keyCode===13){$("#submit_search").click()}});$("#submit_search").on("click",function(){var a="";$("#search_table input").each(function(){$this=$(this);$val=$.trim($this.val());if($val.length>0){op_name=$this.attr("id").split("_")[1];a+=op_name+":"+$val+" "}});var f=$("#search_local").val();var d=f.replace(/ *\b[^: ]+:.*/,"");a=d+" "+a;if(a.length>0){a=$.trim(a);$("#search_local").val(a)}var c=jQuery.Event("keyup");c.keyCode=13;$("#search_local").trigger(c)});$(document).on("click",".tag_button, #tags_sorted_list li",function(){var a=$(this).text();$("#search_local").val("tag: "+a);var c=jQuery.Event("keyup");c.keyCode=13;$("#search_local").trigger(c)});$("#library_page").on("click",".call_part",function(){var c=$(this);var a=[];var f=c.prevAll(".call_part").addBack();$(f).each(function(h,g){a.push($(g).text())});a=a.join(".");$("#search_local").val("call: "+a);var d=jQuery.Event("keyup");d.keyCode=13;$("#search_local").trigger(d)});$("#lib_home").on({mouseenter:function(){var c=$(this).attr("class").split(" ")[2];star_num=c.replace(/\D/g,"");var a=1;for(a=1;a<star_num;a++){$(this).parent().find(".star_"+a).addClass("star_add")}},mouseleave:function(){var a=$(this).parent().attr("id");rating=parseInt(a.replace(/\D/g,""));rating=rating+1;for(i=rating;i<11;i++){$(this).parent().find(".star_"+i).removeClass("star_add")}}},".star");$(document).on("click",".star",function(d){var f=$(this).parent();var a=$(this).attr("class").split(" ")[2];rating=a.replace(/\D/g,"");var c=$(this).closest(".book_finds").attr("id");join_id=c.split("_")[1];$.ajax({type:"POST",url:"functions/book-rating.php",data:"join_id="+encodeURIComponent(join_id)+"&rating="+encodeURIComponent(rating),success:function(g){f.html(g);f.attr("id","rated_"+rating)}})});$(document).on("click",".star_reset",function(d){var a=$(this).parent().prev(".star_rating");var c=$(this).closest(".book_finds").attr("id");join_id=c.split("_")[1];$.ajax({type:"POST",url:"functions/book-rating.php",data:"join_id="+encodeURIComponent(join_id)+"&rating=empty",success:function(f){a.html(f);a.attr("id","rated_0")}})});$("#library_load").on("click",".add_tags span, .add_tags .sprite",function(){$(this).closest(".detail").find(".tags_text").slideToggle(150);var a=$(this).closest(".detail").find(".tags_text input").val();$(this).closest(".detail").find(".tags_text input").focus().val("").val(a)});$("#library_load").on("click",".add_notes span, .add_notes .sprite",function(){$(this).closest(".detail").find(".notes_text").slideToggle(150);var a=$(this).closest(".detail").find(".notes_text textarea").val();$(this).closest(".detail").find(".notes_text textarea").focus().val("").val(a)});$("#library_load").on("click",".add_group span, .add_group .sprite",function(){$(this).closest(".detail").find(".groups_text").slideToggle(150);var a=$(this).closest(".detail").find(".groups_text input").val();$(this).closest(".detail").find(".groups_text input").focus().val("").val(a)});$("#library_load").on("click",".add_review, .add_review .sprite, .cancel_review",function(){$(this).closest(".detail").find(".review_text").slideToggle(150)});$("#library_load").on("click",".move_item span, .move_item .sprite",function(){$(this).closest(".detail").find(".move_text").slideToggle(150)});$("#library_load").on("click",".status_scroll .close",function(){$(this).closest(".status_scroll").toggleClass("open-history")});$(document).on("click",".move_opts",function(){var a=$(this).attr("id");a=a.split("_")[2];var d=$(this).val();$.ajax({type:"POST",url:"functions/item-move.php",data:"join_id="+encodeURIComponent(a)+"&library_id="+encodeURIComponent(d),success:function(f){b();$(".controls_wrapper > div.using").removeClass("using")}});var c=$(this).closest(".detail");c.animate({opacity:0.25,left:"+=800",height:5},550,function(){c.remove()})});$(document).on("mouseenter",".add_title span, .add_title .sprite",function(){$(this).closest(".detail").find(".book_title, .book_authors:not(:empty)").css({"border-bottom":"1px dotted #4BC1D2","margin-bottom":"-1px"});$(this).closest(".detail").find(".book_description:not(:empty), .book_description_full").css({"border-bottom":"1px dotted #4BC1D2","margin-bottom":"13px"})}).on("mouseleave",".add_title span, .add_title .sprite",function(){$(this).closest(".detail").find(".book_title, .book_authors:not(:empty)").css({"border-bottom":"none","margin-bottom":"0px"});$(this).closest(".detail").find(".book_description:not(:empty), .book_description_full").css({"border-bottom":"none","margin-bottom":"14px"})});$(document).on("click",".add_title span, .add_title .sprite",function(){var d=$(this).parent(".add_title").find("span");var a=d.parents().siblings(".book_finds").attr("id");var c=a.split("_")[1];if(d.hasClass("clicked")){d.removeClass("clicked");$.post("/library/functions/books-info-single.php",{join_id:c}).done(function(f){$("#"+a).parent().html(f)})}else{d.addClass("clicked warning");d.text("Cancel");d.parent().find(".sprite").css({"background-image":"url(/images/icons/icon-cancel.svg)"});d.parent().siblings().each(function(){$(this).fadeOut("fast")});d.closest(".detail").find(".book_info").load("/library/functions/manual-update-partial.php?join_id="+c);d.closest(".detail").find(".copies").hide()}});$(document).on("mouseenter",".edit_all span, .edit_all .sprite",function(){$(this).closest(".detail").find("p").each(function(){if($(this).text().length>0&&($(this).hasClass("book_description")||$(this).hasClass("book_description_full"))){$(this).css({"border-bottom":"1px dotted #4BC1D2","margin-bottom":"13px"})}else{if($(this).text().length>0){$(this).css({"border-bottom":"1px dotted #4BC1D2","margin-bottom":"-1px"})}else{}}})}).on("mouseleave",".edit_all span, .edit_all .sprite",function(){$(this).closest(".detail").find("p").css({"border-bottom":"none","margin-bottom":"0px"});$(this).closest(".detail").find(".book_description:not(:empty), .book_description_full").css({"border-bottom":"none","margin-bottom":"14px"})});$(document).on("click",".edit_all span, .edit_all .sprite",function(){var a=$(this).closest(".detail").find(".book_finds").attr("id");var c=a.split("_")[1];if($(this).parent(".edit_all").find("span").hasClass("clicked")){$(this).parent(".edit_all").find("span").removeClass("clicked");$.post("/library/functions/books-info-single.php",{join_id:c}).done(function(d){$("#"+a).parent().html(d)})}else{$(this).parent().find(".sprite").css({"background-image":"url(/images/icons/icon-cancel.svg)"});$(this).parent().siblings().each(function(){$(this).fadeOut("fast")});$(this).parent(".edit_all").find("span").addClass("clicked warning");$(this).parent(".edit_all").find("span").text("Cancel Edit");$("#"+a+" .add_review,#"+a+" .add_group,#"+a+" .add_notes,#"+a+" .add_notes,#"+a+" .add_tags,#"+a+" .move_item").css({color:"#CCC"});$("#"+a+" .add_review span,#"+a+" .add_group span,#"+a+" .add_notes span,#"+a+" .add_notes span,#"+a+" .add_tags span,#"+a+" .move_item span").css({cursor:"auto"});$(this).closest(".detail").find(".book_info").load("/library/functions/manual-update.php?join_id="+c)}});$(document).on("keydown","textarea.book_notes",function(d){var a=$(this).val();if(d.keyCode==13&&d.shiftKey){}else{if(d.keyCode==13&&a!=undefined){d.preventDefault();var c=$(this).closest(".book_finds").attr("id");join_id=c.split("_")[1];var f=$(this).parent();$.ajax({type:"POST",url:"functions/notes-add.php",data:"join_id="+encodeURIComponent(join_id)+"&notes="+encodeURIComponent(a),success:function(g){f.toggle("fast");$(".controls_wrapper > div.using").removeClass("using");var h=$.trim(g);if(h==""){f.parent().find(".notes").removeClass("active_notes")}else{f.parent().find(".notes").addClass("active_notes");h=h.replace(/\n/g,"<br>")}f.parent().find(".notes").html(h)}})}}});$("#lib_home").on("click",".add_review",function(){var c=$(this).parents(".detail");var a=$(c).find(".review_text textarea");$(a).tinymce({script_url:"js/tinymce/tinymce.min.js",menubar:false,resize:false,height:250,skin:"light",plugins:["link"],toolbar:"bold italic strikethrough | blockquote | bullist numlist | link",target_list:false,link_title:false,toolbar_items_size:"small"})});$(document).on("click",".save_review",function(d){tinyMCE.triggerSave();var a=$(this).nextAll("textarea").val();if(a==undefined){a=""}d.preventDefault();var c=$(this).closest(".book_finds").attr("id");join_id=c.split("_")[1];var f=$(this).parent();$.ajax({type:"POST",url:"functions/review-add.php",data:"join_id="+encodeURIComponent(join_id)+"&review="+encodeURIComponent(a),success:function(g){f.toggle("fast")}})});$(document).on("keyup","input.book_tags",function(c){var a=$(this).val();a=a.replace(/:/g," ");console.log(a);if(a){var d=a.replace(/,/g,'</span><span class="tag_button">');$(this).parent().nextAll("div.tags").html('<span class="tag_button">'+d+"</span>")}else{$(this).parent().nextAll("div.tags").html("")}});$(document).on("keydown","input.book_tags",function(c){var d=$(this);var g=$(this).val();g=g.replace(/(<([^>]+)>)/ig,"");if(c.keyCode==13&&g!="undefined"){var j=$(this).closest(".book_finds").attr("id");join_id=j.split("_")[1];c.preventDefault();var f=$(this).parent();$.ajax({type:"POST",url:"functions/tags-add.php",data:"join_id="+encodeURIComponent(join_id)+"&tags="+encodeURIComponent(g),success:function(k){f.toggle("fast");$(".controls_wrapper > div.using").removeClass("using")}})}else{var h,a;h={serviceUrl:"functions/tags-autocomplete.php",minChars:1,deferRequestBy:0,delimiter:","};a=$(d).autocomplete(h)}});$(document).on("keydown","input.book_groups",function(c){var f=$(this);var d=$.trim($(this).val());if(c.keyCode==13){var j=$(this).closest(".book_finds").attr("id");join_id=j.split("_")[1];c.preventDefault();var g=$(this).parent();$.ajax({type:"POST",url:"functions/group-add.php",data:"join_id="+encodeURIComponent(join_id)+"&group="+encodeURIComponent(d),success:function(k){g.toggle("fast");$(".controls_wrapper > div.using").removeClass("using")}})}else{var h,a;h={serviceUrl:"functions/group-autocomplete.php",minChars:1,deferRequestBy:0};a=$(f).autocomplete(h)}});$("#library_page").on("click",".mini-status span",function(){var c=$(this);var a=c.parent().attr("id");var d=c.closest(".book_image").find(".status_scroll");if(d.hasClass("open-history")){d.removeClass("open-history");d.find("tr").each(function(){$(this).removeClass("bg_callout")})}else{d.addClass("open-history");d.find("#"+a).closest("tr").addClass("bg_callout")}});$("#library_page").on("click",".status_container .add_status",function(){var d=$(this);var c=$(this).closest(".book_finds").attr("id");var a=c.split("_")[1];$.ajax({type:"POST",url:"functions/add-status.php",data:"join_id="+encodeURIComponent(a)}).done(function(f){var g=parseInt(d.parent().parent().find(".status_badge").text());d.siblings(".status_badge").text(g+1);d.closest(".book_image").find(".status_scroll").addClass("open-history");d.closest(".detail").find(".view_history").addClass("using");d.closest(".detail").find(".status_scroll").children(".history").append(f);var h=$(f).find(".choose_status").text();var j=$(f).find(".viewed_status").attr("id");d.parent().siblings(".mini-status").append('<div id="'+j+'"><span>'+h+"</span></div>");b()})});var y=null;$("#library_page").on("click",".delete_status",function(){var d=$(this);var g=d.closest(".viewed_status").attr("id");var h=d.closest(".book_image").find(".status_badge");var f=parseInt(h.text());var c=d.closest(".book_finds").attr("id");var a=c.split("_")[1];modal("Delete this status?","Delete","modal_delete",function(){d.closest(".book_image").find("#"+g).remove();h.text(f-1);$viewed=d.closest(".viewed_status").parents("tr");$viewed.remove();$.ajax({type:"POST",url:"functions/delete-status.php",data:{status_id:encodeURIComponent(g),join_id:a}}).done(function(){b()})},function(){})});$("#library_page").on({mouseenter:function(){$(this).children(".status_options").slideDown("fast")},mouseleave:function(){$(this).children(".status_options").hide()}},".viewed_status");$("#library_page").on("click",".completed, .in_progress, .abandoned, .not_begun",function(d){var c=$(this);var g=$(this).attr("class");var a=g.replace("_"," ");a=a.charAt(0).toUpperCase()+a.slice(1);$(this).parent().prev("span").text(a).css("color","#333333");var f=$(this).closest(".viewed_status").attr("id");c.closest(".book_image").find("#"+f).html("<span>"+a+"</span>");$.ajax({type:"POST",url:"functions/edit-status.php",data:"status="+encodeURIComponent(g)+"&status_id="+encodeURIComponent(f)}).done(function(h){b();status_of_dates=h.split(":");$(c).parents(".viewed_status").parents("td").next().children(".began_date").remove();$(c).parents(".viewed_status").parents("td").next().next().children(".completed_date").remove();if(g=="completed"){$(c).parents(".viewed_status").parents("td").next().append('<div class="dc dc_began began_date dc_line" data-field="date">'+status_of_dates[0]+"</div>");$(c).parents(".viewed_status").parents("td").next().next().append('<div class="dc dc_completed completed_date dc_line" data-field="date">'+status_of_dates[1]+"</div>");$(c).parent(".status_options").hide()}else{if(g=="in_progress"||g=="abandoned"){$(c).parents(".viewed_status").parents("td").next().append('<div class="dc dc_began began_date dc_line" data-field="date">'+status_of_dates[0]+"</div>");$(c).parents(".viewed_status").parents("td").next().next().children(".completed_date").remove();$(c).parent(".status_options").hide()}else{$(c).parents(".viewed_status").parents("td").next().children(".began_date").remove();$(c).parents(".viewed_status").parents("td").next().next().children(".completed_date").remove();$(c).parent(".status_options").hide()}}})});var t=null;$("#dtBox").DateTimePicker({dateFormat:"yyyy-MM-dd",titleContentDate:"",buttonsToDisplay:["SetButton"],animationDuration:100,beforeShow:function(){t=null},buttonClicked:function(a){t=a},afterHide:function(d){if(d){var g=$(d).text();var c=$(d).closest(".book_finds").attr("id");var a=c.split("_")[1];var f=$(d).parents("tr").find(".viewed_status").attr("id");if($(d).hasClass("completed_date")){date_type="completed"}else{date_type="began"}if(t=="SET"||t=="TAB"){$.ajax({type:"POST",url:"functions/completed-date.php",data:{selected_date:encodeURIComponent(g),join_id:encodeURIComponent(a),status_id:encodeURIComponent(f),date_type:encodeURIComponent(date_type)}}).done(function(h){if($.trim(h)=="fail"){notification("There was an error updating the status date. Please refresh and try again!","notification_warning")}else{notification("Status date successfully updated!","notification_success")}})}}}});$(window).resize(function(){var a=$(".inner-wrapper").width()-9;$(".letter_range_fixed").css({width:a,left:220})});$(".inner-wrapper").scroll(function(f){var g=$(this).scrollTop();if(g>=top){$("#to_top").show()}else{$("#to_top").hide()}if(g>=138&&F){$("#letter_range").addClass("fixed");$("#letter_range").addClass("letter_range_fixed");$("#library_top").css("margin-bottom",35);var k=$(".inner-wrapper").width()-10;$(".letter_range_fixed").css({width:k,left:220})}else{$("#library_top").css("margin-bottom",0);$(".letter_range_fixed").css({width:"100%",left:"0"});$("#letter_range").removeClass("fixed");$("#letter_range").removeClass("letter_range_fixed")}var l=parseInt($("#more").attr("class"));if($(this).scrollTop()+$(this).innerHeight()+75>=this.scrollHeight&&!isNaN(l)){var c=$("#letter_range .active").attr("id");if(c=="all"){c="all"}else{if(c=="number"){c="number"}else{if(c!=""&&c!=undefined){var c=c.charAt(c.length-1)}else{c="all"}}}var j=$(".hide_first_letter:last").text();var a=$(".group_name:last, .group_name_cover:last").text();$("#more").remove();$.ajax({type:"POST",url:"functions/load-library.php",data:"letter="+encodeURIComponent(c)+"&limit="+encodeURIComponent(l)+"&letter_heading="+encodeURIComponent(j)+"&group_heading="+encodeURIComponent(a)}).done(function(m){$("#library_load #library_inner").append(m)})}var d=parseInt($("#search_more").attr("class"));if($(this).scrollTop()+$(this).innerHeight()+75>=this.scrollHeight&&!isNaN(d)){var h=$("#more_search_term").val();$("#search_more").remove();$.ajax({type:"POST",url:"functions/search.php",data:"search="+encodeURIComponent(h)+"&limit="+encodeURIComponent(d)}).done(function(m){$("#library_load").append(m)})}});var A=window.location.pathname;$("#first-sidebar nav li a[href='"+A+"']").parent("li").addClass("active-item");var x=navigator.platform.toUpperCase().indexOf("MAC")>=0;if(x&&$(".nofeed").length!==0){$(".inner-wrapper").on("mousewheel",function(d,c,f,a){d.preventDefault();$(".inner-wrapper").scrollTop($(".inner-wrapper").scrollTop()-a)});$("#social_feed_scroll").on("mousewheel",function(d,c,f,a){d.preventDefault();$("#social_feed_scroll").scrollTop($("#social_feed_scroll").scrollTop()-a)})}$("body").on("click",".controls_wrapper > div",function(){$(".controls_wrapper > div").removeClass(".using");$(this).toggleClass("using")});function e(){return"ontouchstart" in window||"onmsgesturechange" in window}var z=e();var D=$("#social_feed");var G=$("#social_feed .feed_post span.post_user, #social_feed .feed_post user");var v=$("#feed-button");var B=$("div.close-feed");var E=(window.innerWidth>0)?window.innerWidth:screen.width;if(z==true&&E<501){B.on("touchend",function(){D.hide();return false});G.on("click",function(){D.hide();$("html, body").animate({scrollTop:$("#library_load").offset().top-30})});v.on("touchend",function(){D.show();return false});$("textarea, input").on("focus",function(){$("#mobile-footer-menu, #to_top").hide()});$("textarea, input").on("blur",function(){$("#mobile-footer-menu").show()})}else{B.on("click",function(){D.hide();return false});v.on("click",function(){D.show();return false})}});